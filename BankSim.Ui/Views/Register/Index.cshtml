@{
    ViewData["Title"] = "Kayıt Ol | BankSim";
}

<div class="register-page d-flex align-items-center justify-content-center">
    <div class="register-card text-center p-5">
        <div class="logo mb-4">
            <img src="https://cdn-icons-png.flaticon.com/512/2936/2936884.png"
                 alt="BankSim Logo"
                 width="90"
                 class="shadow rounded-circle p-2 bg-light" />
        </div>
        <h2 class="fw-bold mb-4" style="color:#003366;">Yeni Hesap Oluştur</h2>
        <form id="registerForm" autocomplete="off">
            <div class="mb-3 input-group">
                <span class="input-group-text icon-bg"><i class="bi bi-person-fill"></i></span>
                <input id="fullName" class="form-control form-control-lg rounded-pill ps-3" placeholder="Adınız ve Soyadınız" required />
            </div>
            <div class="mb-3 input-group">
                <span class="input-group-text icon-bg"><i class="bi bi-lock-fill"></i></span>
                <input id="identityNumber"
                       type="text"
                       class="form-control form-control-lg rounded-pill ps-3"
                       placeholder="Tc Kimlik Numaranız"
                       inputmode="numeric"
                       pattern="\d{11}"
                       maxlength="11"
                       minlength="11"
                       required
                       oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
            </div>
            <div class="mb-3 input-group">
                <span class="input-group-text icon-bg"><i class="bi bi-telephone-fill"></i></span>
                <input id="phone"
                       type="text"
                       class="form-control form-control-lg rounded-pill ps-3"
                       placeholder="Telefon Numaranız"
                       inputmode="numeric"
                       pattern="05\d{9}"
                       maxlength="11"
                       minlength="11"
                       required
                       oninput="this.value = this.value.replace(/[^0-9]/g, '');" />
            </div>
            <div class="mb-3 input-group">
                <span class="input-group-text icon-bg"><i class="bi bi-envelope-fill"></i></span>
                <input id="email" type="email" class="form-control form-control-lg rounded-pill ps-3" placeholder="E-posta adresiniz" required />
            </div>
            <div class="mb-3 input-group">
                <span class="input-group-text icon-bg"><i class="bi bi-lock-fill"></i></span>
                <input id="password" type="password" class="form-control form-control-lg rounded-pill ps-3" placeholder="Şifreniz" required />
            </div>
            <div class="mb-3 input-group">
                <span class="input-group-text icon-bg"><i class="bi bi-lock-fill"></i></span>
                <input id="confirmPassword" type="password" class="form-control form-control-lg rounded-pill ps-3" placeholder="Şifrenizi Onaylayın" required />
            </div>
            <div id="registerError" class="alert alert-danger rounded-pill mt-2 d-none"></div>
            <div id="registerSuccess" class="alert alert-success rounded-pill mt-2 d-none"></div>
            <button type="submit" class="btn btn-primary btn-lg w-100 rounded-pill mt-3 shadow-sm">
                Kayıt Ol
            </button>
        </form>
        <div class="mt-4 text-muted">
            Zaten hesabınız var mı?
            <a href="/Login/Index" class="fw-semibold" style="color:#009ddc;">Giriş Yap</a>
        </div>
    </div>
</div>

<style>
    html, body {
        height: 100%;
        margin: 0;
    }

    body {
        background: linear-gradient(120deg, #f6fbff 0%, #bfe2f7 100%);
        background-size: cover;
        background-attachment: fixed;
    }

    .register-page {
        min-height: 100vh;
        width: 100%;
    }

    .register-card {
        background: #fff;
        border-radius: 1rem;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 4px 30px rgba(0, 51, 102, 0.1);
    }

    .icon-bg {
        background: #e0f2fb;
        border: none;
        border-top-left-radius: .75rem;
        border-bottom-left-radius: .75rem;
        color: #009ddc;
        font-size: 1.2rem;
    }

    .form-control:focus {
        box-shadow: 0 0 0 0.25rem rgba(0, 157, 220, 0.25);
        border-color: #009ddc;
    }

    .btn-primary {
        background: #009ddc;
        border: none;
        transition: background 0.3s, transform 0.2s;
    }

        .btn-primary:hover {
            background: #007bb5;
            transform: translateY(-2px);
        }

    .alert-danger {
        background: rgba(220,53,69,0.1);
        color: #dc3545;
        border: none;
    }

    .alert-success {
        background: rgba(40,167,69,0.1);
        color: #28a745;
        border: none;
    }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

@section Scripts {
    <script>
        const API_BASE = window.API_BASE_URL;

        if (sessionStorage.getItem('token')) {
            window.location.href = "/Dashboard/Index";
        }

        document.getElementById('registerForm').onsubmit = async function(e) {
            e.preventDefault();
            const fullName = document.getElementById('fullName').value.trim();
            const identityNumber = document.getElementById('identityNumber').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            const errDiv = document.getElementById('registerError');
            const succDiv = document.getElementById('registerSuccess');
            errDiv.classList.add('d-none');
            succDiv.classList.add('d-none');
            errDiv.innerText = "";
            succDiv.innerText = "";

            if (!fullName || !identityNumber || !phone || !email || !password || !confirmPassword) {
                errDiv.innerText = "Tüm alanları doldurunuz!";
                errDiv.classList.remove('d-none');
                return;
            }
            if (identityNumber.length !== 11) {
                errDiv.innerText = "T.C. Kimlik Numarası 11 haneli olmalıdır!";
                errDiv.classList.remove('d-none');
                return;
            }
            if (phone.length !== 11 || !phone.startsWith("05")) {
                errDiv.innerText = "Telefon numarası 11 haneli ve 05 ile başlamalıdır!";
                errDiv.classList.remove('d-none');
                return;
            }
            if (password !== confirmPassword) {
                errDiv.innerText = "Şifreler uyuşmuyor!";
                errDiv.classList.remove('d-none');
                return;
            }

            const resp = await fetch(API_BASE + '/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    fullName,
                    identityNumber,
                    phone,
                    email,
                    password,
                    confirmPassword
                })
            });

            if (!resp.ok) {
                const msg = await resp.text();
                errDiv.innerText = msg || "Kayıt başarısız!";
                errDiv.classList.remove('d-none');
                return;
            }

            succDiv.innerText = "Kayıt başarılı! Giriş ekranına yönlendiriliyorsunuz...";
            succDiv.classList.remove('d-none');
            setTimeout(() => window.location.href = "/Login/Index", 1200);
        };
    </script>
}
